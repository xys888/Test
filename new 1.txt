SELECT
	a.company_name AS companyName,
	dvi.vehicle_license AS vehicleLicence,
	gwi.warn_unid AS warnUnid,
	gwi.vehicle_id AS vehicleId,
	gwi.file_name AS fileName
FROM
	(
		SELECT
			*
		FROM
			dim_company_info_t x,
			(
				SELECT
					getChildCompanyIdsList (86) pids
			) y
		WHERE
			FIND_IN_SET(x.id, y.pids)
	) a
LEFT JOIN dim_vehicle_info dvi ON dvi.company_id = a.id
LEFT JOIN (
					SELECT
						vehicle_id,
						warn_unid,
						file_name
					FROM
						gnss_warn_info
					WHERE
						update_time BETWEEN '2019-12-08 00:00:00'
					AND '2019-12-08 12:00:00'
) gwi ON gwi.vehicle_id = dvi.vehicle_id
WHERE
	a.company_status = 1 AND dvi.vehicle_status = 1
	=============================================
	SELECT
	a.company_name AS companyName,
	dvi.vehicle_license AS vehicleLicence,
	gwdi.unid AS unid,
	gwdi.vehicle_id AS dsmVehicleId
FROM
	(
		SELECT
			*
		FROM
			dim_company_info_t x,
			(
				SELECT
					getChildCompanyIdsList (86) pids
			) y
		WHERE
			FIND_IN_SET(x.id, y.pids)
	) a
LEFT JOIN dim_vehicle_info dvi ON dvi.company_id = a.id
LEFT JOIN (
	SELECT
		vehicle_id,
		unid
	FROM
		gnss_warn_dsm_info
	WHERE
		update_time BETWEEN '2019-12-08 00:00:00'
	AND '2019-12-08 12:00:00'
) gwdi on gwdi.vehicle_id=dvi.vehicle_id
WHERE
	a.company_status = 1 AND dvi.vehicle_status = 1
	============================================
	SELECT
	a.company_name AS companyName,
	dvi.vehicle_license AS vehicleLicence,
	gwi.warn_unid AS warnUnid,
	gwdi.unid AS unid,
	gwi.vehicle_id AS vehicleId,
	gwdi.vehicle_id AS dsmVehicleId,
	gwi.file_name AS fileName
FROM
	(
		SELECT
			*
		FROM
			dim_company_info_t x,
			(
				SELECT
					getChildCompanyIdsList (86) pids
			) y
		WHERE
			FIND_IN_SET(x.id, y.pids)
	) a
LEFT JOIN dim_vehicle_info dvi ON dvi.company_id = a.id
LEFT JOIN (
				SELECT
					vehicle_id,
					warn_unid,
					file_name
				FROM
					gnss_warn_info
				WHERE
					update_time BETWEEN '2019-12-08 00:00:00'
				AND '2019-12-08 12:00:00'
				) gwi 
				ON gwi.vehicle_id = dvi.vehicle_id
LEFT JOIN (
				SELECT
					vehicle_id,
					unid
				FROM
					gnss_warn_dsm_info
				WHERE
					update_time BETWEEN '2019-12-08 00:00:00'
				AND '2019-12-08 12:00:00'
			 ) gwdi 
				ON gwdi.unid = gwi.warn_unid
WHERE
	a.company_status = 1 AND dvi.vehicle_status = 1
	
============================================================
	
	TF卡状态
	select  
		dvi.vehicle_license as vehicleLicence,
		a.company_name as companyName,
		dts.update_time as updateTime,
		(case dts.tf_status
		when 1 THEN '插入'
		ELSE  '未插入'
		END) as tfStatus,
		dts.count_data as aountDate,
		dts.use_data useData,
		dts.surplus_data as surplus_data,
		(case dts.warn_status
		when 1 THEN '正常'
		ELSE  '异常'
		END)  as warnStatus,
    dts.remark as remark
from (
		SELECT * 
      from dim_company_info_t x,
					(
						select getChildCompanyIdsList() pids
)y
WHERE FIND_IN_SET(x.id,y.pids)
) a
LEFT JOIN dim_vehicle_info dvi on dvi.company_id=a.id
LEFT JOIN dsm_tf_status_info dts on dvi.vehicle_id=dts.vehicle_id
where dvi.vehicle_status=1 and a.company_status=1

===========================================================
2019-12-10 15:17:25
SELECT
	a.company_name AS companyName,
	dvi.vehicle_license AS vehicleLicence,
	gwi.warn_unid AS warnUnid,
	gwi.vehicle_id AS vehicleId,
	gwi.url AS url,
	gwi.create_time
FROM	
	(
		SELECT
			*
		FROM
			dim_company_info_t x,
			(
				SELECT
					getChildCompanyIdsList (86) pids
			) y
		WHERE
			FIND_IN_SET(x.id, y.pids)
	) a
LEFT JOIN dim_vehicle_info dvi ON dvi.company_id = a.id
 JOIN (
					SELECT
						vehicle_id,
						warn_unid,
						url,
						SUBSTR(warn_unid,1,2) as subUnid,
						create_time,
						file_type	
					FROM
						gnss_warn_info
					WHERE
						update_time BETWEEN '2019-12-08 00:00:00'
					AND '2019-12-10 12:00:00'
) gwi ON gwi.vehicle_id = dvi.vehicle_id
WHERE
	a.company_status = 1 AND dvi.vehicle_status = 1 and gwi.subUnid=65 and gwi.file_type=0;




SELECT
	a.company_name AS companyName,
	dvi.vehicle_license AS vehicleLicence,
	gwdi.unid AS unid,
	gwdi.vehicle_id AS dsmVehicleId,
gwdi.create_time
FROM
	(
		SELECT
			*
		FROM
			dim_company_info_t x,
			(
				SELECT
					getChildCompanyIdsList (86) pids
			) y
		WHERE
			FIND_IN_SET(x.id, y.pids)
	) a
LEFT JOIN dim_vehicle_info dvi ON dvi.company_id = a.id
JOIN (
	SELECT
		vehicle_id,
		unid,
		create_time
	FROM
		gnss_warn_dsm_info
	WHERE
		update_time BETWEEN '2019-12-08 00:00:00'
	AND '2019-12-10 12:00:00'
) gwdi on gwdi.vehicle_id=dvi.vehicle_id
WHERE
	a.company_status = 1 AND dvi.vehicle_status = 1;
SELECT
	a.company_name AS companyName,
	dvi.vehicle_license AS vehicleLicence,
	gwi.warn_unid AS warnUnid,
	gwdi.unid AS unid,
	gwi.vehicle_id AS vehicleId,
	gwdi.vehicle_id AS dsmVehicleId,
	gwi.file_name AS fileName
FROM
	(
		SELECT
			*
		FROM
			dim_company_info_t x,
			(
				SELECT
					getChildCompanyIdsList (86) pids
			) y
		WHERE
			FIND_IN_SET(x.id, y.pids)
	) a
LEFT JOIN dim_vehicle_info dvi ON dvi.company_id = a.id
LEFT JOIN (
				SELECT
					vehicle_id,
					warn_unid,
					file_name
				FROM
					gnss_warn_info
				WHERE
					update_time BETWEEN '2019-12-08 00:00:00'
				AND '2019-12-10 12:00:00'
				) gwi 
				ON gwi.vehicle_id = dvi.vehicle_id
LEFT JOIN (
				SELECT
					vehicle_id,
					unid
				FROM
					gnss_warn_dsm_info
				WHERE
					update_time BETWEEN '2019-12-08 00:00:00'
				AND '2019-12-10 12:00:00'
			 ) gwdi 
				ON gwdi.unid = gwi.warn_unid
WHERE
	a.company_status = 1 AND dvi.vehicle_status = 1